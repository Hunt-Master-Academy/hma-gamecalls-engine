╔══════════════════════════════════════════════════════════════════════════════════════════════════╗
║                          Pre-WASM Validation - Huntmaster Audio Engine                         ║
╚══════════════════════════════════════════════════════════════════════════════════════════════════╝

[0;34m[INFO][0m Starting pre-WASM validation...
[0;34m[INFO][0m Fix issues automatically: false
[0;34m[INFO][0m Verbose output: true

[0;35m[CHECK][0m Validating build system...
[0;32m[✓][0m CMake found: 3.28.3
[1;33m[⚠][0m Emscripten not found - required for WASM compilation
[0;32m[✓][0m Native build directory exists
[0;35m[CHECK][0m Checking WASM compatibility...
[0;32m[✓][0m WASM compatibility check completed
[0;35m[CHECK][0m Validating audio dependencies...
[0;32m[✓][0m Audio library found: libs/dr_wav.h
[0;32m[✓][0m Audio library found: libs/miniaudio.h
[0;35m[CHECK][0m Analyzing memory usage patterns...
[1;33m[⚠][0m Direct malloc/free usage found (prefer smart pointers for WASM)
[0;32m[✓][0m Memory pattern analysis completed
[0;35m[CHECK][0m Testing core functionality before WASM build...
[0;34m[INFO][0m Running Engine core functionality...
Running main() from /mnt/e/develop/Huntmaster/huntmaster-engine/build/_deps/googletest-src/googletest/src/gtest_main.cc
[==========] Running 7 tests from 1 test suite.
[----------] Global test environment set-up.
[----------] 7 tests from UnifiedEngineTest
[ RUN      ] UnifiedEngineTest.SessionCreationAndDestruction
[TestPaths] Initialized:
  Project root: "/mnt/e/develop/Huntmaster/huntmaster-engine"
  Data root: "/mnt/e/develop/Huntmaster/huntmaster-engine/data"
  Temp root: "/tmp/huntmaster_test_1753327736049"
[       OK ] UnifiedEngineTest.SessionCreationAndDestruction (24 ms)
[ RUN      ] UnifiedEngineTest.PerSessionMasterCallLoading
[       OK ] UnifiedEngineTest.PerSessionMasterCallLoading (4 ms)
[ RUN      ] UnifiedEngineTest.ConcurrentSessionOperations
[       OK ] UnifiedEngineTest.ConcurrentSessionOperations (5 ms)
[ RUN      ] UnifiedEngineTest.SessionIsolation
[       OK ] UnifiedEngineTest.SessionIsolation (0 ms)
[ RUN      ] UnifiedEngineTest.InvalidSessionHandling
[       OK ] UnifiedEngineTest.InvalidSessionHandling (0 ms)
[ RUN      ] UnifiedEngineTest.ResultPatternConsistency
[       OK ] UnifiedEngineTest.ResultPatternConsistency (2 ms)
[ RUN      ] UnifiedEngineTest.LegacyMigrationPattern
[       OK ] UnifiedEngineTest.LegacyMigrationPattern (6 ms)
[----------] 7 tests from UnifiedEngineTest (44 ms total)

[----------] Global test environment tear-down
[==========] 7 tests from 1 test suite ran. (44 ms total)
[  PASSED  ] 7 tests.
[0;32m[✓][0m Engine core functionality passed
[0;34m[INFO][0m Running MFCC processing...
Running main() from /mnt/e/develop/Huntmaster/huntmaster-engine/build/_deps/googletest-src/googletest/src/gtest_main.cc
[==========] Running 5 tests from 1 test suite.
[----------] Global test environment set-up.
[----------] 5 tests from MFCCConsistencyUnifiedTest
[ RUN      ] MFCCConsistencyUnifiedTest.ExistingMasterCallTest
[TestPaths] Initialized:
  Project root: "/mnt/e/develop/Huntmaster/huntmaster-engine"
  Data root: "/mnt/e/develop/Huntmaster/huntmaster-engine/data"
  Temp root: "/tmp/huntmaster_test_1753327736142"
Debug: Testing with existing buck_grunt master call
---------------------------------------
  Created session with ID: 1
  Successfully loaded buck_grunt master call
  Loaded audio: 7488 frames, 1 channels, 22050 Hz
  processAudioChunk status: 0
  Features processed: 28
  Similarity score: 0.75022656
[       OK ] MFCCConsistencyUnifiedTest.ExistingMasterCallTest (63 ms)
[ RUN      ] MFCCConsistencyUnifiedTest.SineWaveConsistency
Test 1: Processing 440 Hz sine wave
---------------------------------------
Created test file: "/mnt/e/develop/Huntmaster/huntmaster-engine/data/master_calls/test_sine_440.wav"

Processing 5 times:
  Features processed: 171
  Run 1: Score = 0.85022652
  Features processed: 171
  Run 2: Score = 0.85022652
  Features processed: 171
  Run 3: Score = 0.85022652
  Features processed: 171
  Run 4: Score = 0.85022652
  Features processed: 171
  Run 5: Score = 0.85022652

Results:
  Average score: 0.85022652
  Min score: 0.85022652
  Max score: 0.85022652
  Max deviation: 0.00000000 (0.00000000%)
  Status: PASS ✓
[       OK ] MFCCConsistencyUnifiedTest.SineWaveConsistency (392 ms)
[ RUN      ] MFCCConsistencyUnifiedTest.ComplexWaveformConsistency


Test 2: Processing complex waveform
---------------------------------------
  Run 1: Score = 0.85953569
  Run 2: Score = 0.85953569
  Run 3: Score = 0.85953569
  Run 4: Score = 0.85953569
  Run 5: Score = 0.85953569

Results:
  Max deviation: 0.00000000
  Status: PASS ✓
[       OK ] MFCCConsistencyUnifiedTest.ComplexWaveformConsistency (2131 ms)
[ RUN      ] MFCCConsistencyUnifiedTest.RealAudioFileConsistency


Test 3: Processing real audio file
---------------------------------------
  Run 1: Score = 0.75132108
  Run 2: Score = 0.75132108
  Run 3: Score = 0.75132108

Results:
  Max deviation: 0.00000000
  Status: PASS ✓
[       OK ] MFCCConsistencyUnifiedTest.RealAudioFileConsistency (91 ms)
[ RUN      ] MFCCConsistencyUnifiedTest.SelfSimilarityTest
Debug: Testing self-similarity (comparing audio to itself)
---------------------------------------
  Successfully loaded buck_grunt as master call
  Loaded same audio for comparison: 7488 frames
  processAudioChunk status: 0
  Features processed: 28
  Self-similarity score: 0.75022656
  Expected: High similarity (>0.8) since comparing audio to itself
  Similarity level: EXCELLENT
[       OK ] MFCCConsistencyUnifiedTest.SelfSimilarityTest (27 ms)
[----------] 5 tests from MFCCConsistencyUnifiedTest (2706 ms total)

[----------] Global test environment tear-down
[==========] 5 tests from 1 test suite ran. (2706 ms total)
[  PASSED  ] 5 tests.
[0;32m[✓][0m MFCC processing passed
[0;34m[INFO][0m Running DTW algorithm...
Running main() from /mnt/e/develop/Huntmaster/huntmaster-engine/build/_deps/googletest-src/googletest/src/gtest_main.cc
[==========] Running 4 tests from 1 test suite.
[----------] Global test environment set-up.
[----------] 4 tests from DTWUnifiedTest
[ RUN      ] DTWUnifiedTest.BasicDTWFunctionality
[TestPaths] Initialized:
  Project root: "/mnt/e/develop/Huntmaster/huntmaster-engine"
  Data root: "/mnt/e/develop/Huntmaster/huntmaster-engine/data"
  Temp root: "/tmp/huntmaster_test_1753327738894"
=== Basic DTW Functionality Test ===
  Successfully loaded buck_grunt master call
  Loaded audio: 7488 samples, 1 channels, 22050 Hz
  processAudioChunk status: 0
  Features processed: 28
  DTW similarity score: 0.75022656
[       OK ] DTWUnifiedTest.BasicDTWFunctionality (44 ms)
[ RUN      ] DTWUnifiedTest.DTWWithChunkedProcessing

=== DTW with Chunked Processing Test ===
  Processing 7488 samples in chunks
  Processed 8 chunks
  Features processed: 35
  DTW similarity score: 0.75132108
[       OK ] DTWUnifiedTest.DTWWithChunkedProcessing (27 ms)
[ RUN      ] DTWUnifiedTest.DTWConsistencyTest

=== DTW Consistency Test ===
  Run 1/3
    Score: 0.75022656
  Run 2/3
    Score: 0.75022656
  Run 3/3
    Score: 0.75022656

Consistency Analysis:
  Average score: 0.75022656
  Max deviation: 0.00000000 (0.00000000%)
  Status: CONSISTENT ✓
[       OK ] DTWUnifiedTest.DTWConsistencyTest (56 ms)
[ RUN      ] DTWUnifiedTest.SelfSimilarityTest

=== Self-Similarity Test ===
  Comparing audio to itself (should give high similarity)
  Self-similarity score: 0.75022656
  Similarity level: EXCELLENT
[       OK ] DTWUnifiedTest.SelfSimilarityTest (18 ms)
[----------] 4 tests from DTWUnifiedTest (147 ms total)

[----------] Global test environment tear-down
[==========] 4 tests from 1 test suite ran. (147 ms total)
[  PASSED  ] 4 tests.
[0;32m[✓][0m DTW algorithm passed
[0;32m[✓][0m All core functionality tests passed
[0;35m[CHECK][0m Validating WASM build configuration...
[0;32m[✓][0m WASM/Emscripten configuration found in CMakeLists.txt
[0;32m[✓][0m WASM build script found
[0;32m[✓][0m WASM bindings directory found
[1;33m[⚠][0m WASM binding file not found: bindings/wasm/WASMInterface.h
[1;33m[⚠][0m WASM binding file not found: bindings/wasm/WASMInterface.cpp
[0;35m[CHECK][0m Validating web assets and deployment files...
[0;32m[✓][0m Web directory found
[0;32m[✓][0m Web asset found: web/index.html
[0;32m[✓][0m Web asset found: web/test.html
[1;33m[⚠][0m Web asset not found: web/js/huntmaster.js
[0;35m[CHECK][0m Analyzing performance characteristics...
[0;34m[INFO][0m Native library size: 5.3M
[0;34m[INFO][0m Running performance analysis...
=== Huntmaster Performance Testing ===
Testing real-time processing capability and memory usage

Test 1: Real-time Processing Performance
----------------------------------------

Processing 1 seconds of audio:
  Processing time: 678 ms
  Real-time ratio: 67.80% (< 100% is good)
  Chunks/second: 128
  Memory used: 0 MB
  Final score: 0
  Status: FAIL ✗

Processing 5 seconds of audio:
  Processing time: 15278 ms
  Real-time ratio: 305.56% (< 100% is good)
  Chunks/second: 28
  Memory used: 0 MB
  Final score: 0
  Status: FAIL ✗

Processing 10 seconds of audio:
  Processing time: 64567 ms
  Real-time ratio: 645.67% (< 100% is good)
  Chunks/second: 13
  Memory used: 0 MB
  Final score: 0
  Status: FAIL ✗

Processing 30 seconds of audio:
  Processing time: 543697 ms
  Real-time ratio: 1812.32% (< 100% is good)
  Chunks/second: 5
  Memory used: 0 MB
  Final score: 0
  Status: FAIL ✗


Test 2: Memory Leak Detection
-----------------------------
Running 100 session create/reset cycles...
Initial memory: 0 MB
  Iteration 0: 0 MB
  Iteration 10: 0 MB
  Iteration 20: 0 MB
  Iteration 30: 0 MB
  Iteration 40: 0 MB
  Iteration 50: 0 MB
  Iteration 60: 0 MB
  Iteration 70: 0 MB
  Iteration 80: 0 MB
  Iteration 90: 0 MB

Memory analysis:
  Initial: 0 MB
  Final: 0 MB
  Growth: 0 MB
  Status: PASS ✓


Test 3: Chunk Processing Latency
--------------------------------

Chunk size: 256 samples
  Average latency: 0.146 ms
  Max latency: 0.334 ms
  Expected time: 5.805 ms
  Processing overhead: 2.5%
  Status: PASS ✓

Chunk size: 512 samples
  Average latency: 0.226 ms
  Max latency: 0.481 ms
  Expected time: 11.610 ms
  Processing overhead: 1.9%
  Status: PASS ✓

Chunk size: 1024 samples
  Average latency: 0.357 ms
  Max latency: 0.631 ms
  Expected time: 23.220 ms
  Processing overhead: 1.5%
  Status: PASS ✓

Chunk size: 2048 samples
  Average latency: 0.656 ms
  Max latency: 0.993 ms
  Expected time: 46.440 ms
  Processing overhead: 1.4%
  Status: PASS ✓


=== PERFORMANCE TEST SUMMARY ===
Real-time processing: Capable of processing faster than real-time
Memory stability: Good
Latency: Suitable for real-time applications

Performance tests completed successfully!
[0;32m[✓][0m Performance test completed
[0;34m[INFO][0m Generating pre-WASM validation report: pre_wasm_validation_20250723_233924.md
[0;32m[✓][0m Report saved to: pre_wasm_validation_20250723_233924.md

╔══════════════════════════════════════════════════════════════════════════════════════════════════╗
║                                    VALIDATION SUMMARY                                           ║
╚══════════════════════════════════════════════════════════════════════════════════════════════════╝
[0;32m[✓][0m 🎉 Validation PASSED! Engine is ready for WASM compilation.

Next steps:
  1. Run: ./scripts/build_wasm.sh
  2. Test WASM build in browser
  3. Deploy to web environment

[1;33m[⚠][0m Note: 5 warnings were found. Review them for optimization opportunities.
